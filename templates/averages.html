{% macro topTen(post, count, icon) %}
    <div class="top-ten">
        <div class="comment-count">
            <p>{{ count }}</p>
            <img src="{{ url_for('static', filename=icon) }}" />
        </div>
        <h3>{{ post["message"] }}</h3>
        <p>{{ "Posted by " + post["from"]["name"]+ " on " + post["created_time"].split("T")[0] }}</p>
    </div>
{% endmacro %}

<div id="top-posts">
    <!-- Copyright notice
    The "comment.png" icon used in this page was designed by Linh Pham Thi Dieu (http://linhpham.me/). It is free to use for any project.
    It is part of the Miu icon collection, which can be found at http://linhpham.me/miu/
    -->
    <div id="most-commented" style="clear:left">
        <h2>Most commented posts:</h2>
        {% for post in stats.most_commented() %}
            {{ topTen(post, post["comment_count"], "comment.png") }}
        {% endfor %}
    </div>
    
    <!-- Copyright notice
    The "like.png" icon used in this page was designed by IconsMind (https://www.iconsmind.com/) and released under the Creative Commons Attribution 2.5 Generic license.
    It is part of the Social Media icon pack, which can be foud at https://www.iconfinder.com/iconsets/social-media-13
    A copy of the licence can be found at http://creativecommons.org/licenses/by/2.5/legalcode
    No changes were made to the original icon.
    -->
    <div id="most-liked">
        <h2>Most liked posts:</h2>
        {% for post in stats.most_liked_posts() %}
            {{ topTen(post, post["like_count"], "like.png") }}
        {% endfor %}
    </div>
</div>

<div id="length">
    <h2>Average post length:</h2><p>{{ stats.average_post_len|int }}</p>
    <br>
    <h2>Average comment length:</h2><p>{{ stats.average_comment_len|int }}</p>
</div>

<div id="busiest-hours">
    <h2>Busiest Hours</h2>
    <canvas id="hours" width="1000"></canvas>
</div>

<script>
    var data = {
        labels: [
            {% for hour in stats.busiest_hours().keys() %}
                "{{hour}}",
            {% endfor %}
        ],
        datasets: [{
            label: "Busiest hours",
            fillColor: "rgba(59,89,152,0.1)",
            strokeColor: "rgba(59,89,152,1)",
            pointColor: "rgba(59,89,152,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(59,89,152,1)",
            data: [
                {% for hour in stats.busiest_hours().items() %}
                    {{hour}},
                {% endfor %}
            ]}
        ]
    };
    
    var context = $("#hours").get(0).getContext("2d");
    new Chart(context).Line(data);
</script>